---
title: 'CartoDB on iOS: Interactive 3D globe with WhirlyGlobe-Maply for native apps'
date: '2013-06-14T00:09:00+02:00'
tags:
- ios
- 3dglobe
- iphone
- ipad
tumblr_url: http://blog.cartodb.com/post/52898364065/cartodb-on-ios-interactive-3d-globe-with
---
<p><em>Today we hear a fun guestpost from Steve Gifford of <a href="http://www.mousebirdconsulting.com/">Mousebird Consulting</a>. Steve has done some very interesting work with maps using iOS, 3D globes, and CartoDB. Today, he tells us a bit about that work.</em></p>
<p>Way back I whipped up a little demo with <a href="http://cartodb.com/">CartoDB</a>.  For various reasons it seemed like a good idea to refresh that.  Plus playing with their interface is just FUN.</p>
<p><span>Anyway, as a little background, I make the <a href="http://mousebird.github.io/WhirlyGlobe/">WhirlyGlobe-Maply</a> open source toolkit for iOS (iPad, iPhone).  It&#8217;s a 3D globe, it&#8217;s a map, it&#8217;s a dessert topping, it&#8217;s free.  We&#8217;re going to use the globe here.</span></p>
<p><strong><span>The App</span></strong></p>
<p><span>CartoDB is a cloud backed geospatial database.  You can get map tiles from it or you can make SQL queries and get <a href="http://www.geojson.org/geojson-spec.html">GeoJSON</a> back.  For this demo I&#8217;m going to replicate something I do a lot in client apps:  country and region boundaries.</span></p>
<p><img alt="image" src="http://1.bp.blogspot.com/-Hz0oqvOMxlM/UboPxukXPMI/AAAAAAAAAPc/raWjJmrzeRI/s1600/cartodb.jpg" width="650px"/><br/><em>France?  Sure, France.  Why not.</em></p>
<p><span>It goes a little something like this:</span></p>
<p><span>App comes up, it shows a tiled base map.</span></p>
<p><span>User taps on a country, country shows up with a label.</span></p>
<p><span>Regions show up with outlines.</span></p>
<p><span>Lots of users do this for background and it takes up a few MBs of data on their app.  I&#8217;ve always wanted to shove it in the cloud and not schlep it around.</span></p>
<p><strong><span>The Data</span></strong></p>
<p><span>All we&#8217;re using here are the admin0 and admin1&#160;10 meter data sets from <a href="http://www.naturalearthdata.com/">Natural Earth Data</a>.  That&#8217;s a good set of consistent, pretty, logical data sets for doing fairly coarse work.  Big enough to be interesting, small enough to fit in storage.</span></p>
<p><img alt="image" src="http://4.bp.blogspot.com/-PU8X4oZwoos/UboO_SwnGOI/AAAAAAAAAPU/D3eUUlVSoYU/s1600/Screen+Shot+2013-06-13+at+11.25.56+AM.png" width="650px"/><br/><em>Orange!</em></p>
<p><span>Uploading to CartoDB is pretty slick.  I just zipped up the shape files (and all their attendant garbage) and it figured out the rest.  Now I&#8217;ve got two tables I can hit and a nice SQL query tab to try things out.</span></p>
<p><strong><span>The Source</span></strong></p>
<p><span>It&#8217;s all up on <a href="https://github.com/mousebird/cartodbexample">GitHub</a>, of course.  Just clone that and do the dance of submodules (check the <a href="https://github.com/mousebird/cartodbexample/blob/master/README.md">README</a>).  WhirlyGlobe-Maply pulls in all its examples so it gets a little large.  There&#8217;s a binary distribution if you roll that way.</span></p>
<p><span>Let&#8217;s start with the basics.  We want to toss up a globe and we want to get the user taps back via the delegate.</span></p>
<div class="gist"><a href="https://gist.github.com/mousebird/5775058">https://gist.github.com/mousebird/5775058</a></div>
<p><span>Next, we want a nice base layer to look at and we&#8217;ll rotate to San Francisco on startup.</span></p>
<div class="gist"><a href="https://gist.github.com/mousebird/5775200">https://gist.github.com/mousebird/5775200</a></div>
<p><span>Here&#8217;s what that gets you: An interactive globe with an automatically paging tiled base map.</span></p>
<p><img alt="image" src="http://1.bp.blogspot.com/-sN_qKJpVMb0/Ubn3kbPOn9I/AAAAAAAAAO0/9P-oVlmtc4k/s1600/Screen+Shot+2013-06-13+at+9.44.19+AM.png" width="650px"/></p>
<p><span>Cool, but the whole point is display the country where the user taps.  We can get that by filling in one of the delegate methods and then kicking off a query to CartoDB.</span></p>
<div class="gist"><a href="https://gist.github.com/mousebird/5775717">https://gist.github.com/mousebird/5775717</a></div>
<p><span>I&#8217;m using <a href="https://github.com/AFNetworking/AFNetworking">AFNetworking</a> here which is a really nice library for doing network calls on iOS and it uses a lot of modern Objective-C constructs, like <a href="http://developer.apple.com/library/ios/#documentation/cocoa/Conceptual/Blocks/Articles/00_Introduction.html">blocks</a>.  Block syntax often looks like a cat puked on your keyboard, but it works really, really well.</span></p>
<p><span>All we&#8217;re doing here is:</span></p>
<ul><li><span>Building up the CartoDB request, which is a point in polygon test</span></li>
<li><span>Firing it off</span></li>
<li><span>Adding the vector outline when it comes back as GeoJSON</span></li>
<li><span>Adding a label right in the middle of the country</span></li>
</ul><p>Adding the vector outline and label looks like this.</p>
<div class="gist"><a href="https://gist.github.com/mousebird/5775825">https://gist.github.com/mousebird/5775825</a></div>
<p><span>We toss the vector feature up there with a little styling and then do the same for the label.  Tap around a little bit and you&#8217;ll get something like this.</span></p>
<p><img alt="image" src="http://4.bp.blogspot.com/-s18cJY80_fs/UboH3A_igLI/AAAAAAAAAPE/tftPMIm4BD8/s1600/Screen+Shot+2013-06-13+at+10.54.37+AM.png" width="650px"/></p>
<p><span>Pretty easy, and all based on open source.</span></p>
<p><strong><span>The Conclusion</span></strong></p>
<p><span>CartoDB is really neat and I&#8217;d love to see more apps using it as their spatial data back end.  Setting this example up was incredibly easy and it&#8217;s very fluid.</span></p>
<p><span>The version on <a href="https://github.com/mousebird/cartodbexample">GitHub</a> does a few more things, like query the admin1 outlines and keep track of how much we&#8217;re displaying.  It does all this on other threads, because when you do your data processing on the main thread you make an Apple UX designer cry.</span></p>
